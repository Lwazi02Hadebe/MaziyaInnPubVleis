@model MaziyaInnPubVleis.Models.Event
@{
    ViewData["Title"] = "Create Event";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">
            <i class="fas fa-calendar-plus"></i> Create New Event
        </h1>
        <a href="@Url.Action("EventManagement", "Manager")" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to Events
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">Event Details</h6>
                </div>
                <div class="card-body">
                    <form asp-action="CreateEvent" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="form-group">
                            <label asp-for="EventName" class="control-label">Event Name</label>
                            <input asp-for="EventName" class="form-control" placeholder="Enter event name" required />
                            <span asp-validation-for="EventName" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Description" class="control-label">Description</label>
                            <textarea asp-for="Description" class="form-control" rows="3"
                                      placeholder="Describe the event..."></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="EventDate" class="control-label">Start Date & Time</label>
                                    <input asp-for="EventDate" type="datetime-local" class="form-control" required />
                                    <span asp-validation-for="EventDate" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="EndDate" class="control-label">End Date & Time</label>
                                    <input asp-for="EndDate" type="datetime-local" class="form-control" required />
                                    <span asp-validation-for="EndDate" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="MaxAttendees" class="control-label">Maximum Attendees</label>
                                    <input asp-for="MaxAttendees" type="number" class="form-control"
                                           min="1" max="1000" value="100" required />
                                    <span asp-validation-for="MaxAttendees" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="TicketPrice" class="control-label">Ticket Price (R)</label>
                                    <input asp-for="TicketPrice" type="number" step="0.01" class="form-control"
                                           min="0" value="50.00" required />
                                    <span asp-validation-for="TicketPrice" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Create Event
                            </button>
                            <a href="@Url.Action("EventManagement", "Manager")" class="btn btn-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Event Guidelines -->
            <div class="card">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-lightbulb"></i> Event Planning Tips
                    </h6>
                </div>
                <div class="card-body">
                    <h6>Best Practices:</h6>
                    <ul class="small">
                        <li>Schedule events during peak hours (evenings and weekends)</li>
                        <li>Consider capacity and venue limitations</li>
                        <li>Set appropriate ticket prices based on event type</li>
                        <li>Allow sufficient setup and cleanup time</li>
                        <li>Promote events at least 2 weeks in advance</li>
                    </ul>

                    <h6>Popular Event Types:</h6>
                    <ul class="small">
                        <li>Live Music Nights</li>
                        <li>Sports Viewing Parties</li>
                        <li>Theme Nights</li>
                        <li>Holiday Celebrations</li>
                        <li>Special Promotions</li>
                    </ul>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-calendar-week"></i> This Week's Events
                    </h6>
                </div>
                <div class="card-body">
                    <div class="small">
                        @{
                            var upcomingEvents = ViewBag.UpcomingEvents as List<MaziyaInnPubVleis.Models.Event> ?? new List<MaziyaInnPubVleis.Models.Event>();
                        }
                        @if (upcomingEvents.Any())
                        {
                            foreach (var evt in upcomingEvents.Take(3))
                            {
                                <div class="mb-2 p-2 border rounded">
                                    <strong>@evt.EventName</strong><br>
                                    <small>@evt.EventDate.ToString("MMM dd, HH:mm")</small>
                                    <br>
                                    <span class="badge badge-sm badge-success">
                                        @evt.CurrentAttendees / @evt.MaxAttendees
                                    </span>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-muted text-center">No events this week</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Set minimum datetime to current time
            var now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('EventDate').min = now.toISOString().slice(0, 16);
            document.getElementById('EndDate').min = now.toISOString().slice(0, 16);

            // Auto-set end date to 3 hours after start date
            $('#EventDate').change(function () {
                var startDate = new Date($(this).val());
                var endDate = new Date(startDate.getTime() + 3 * 60 * 60 * 1000); // Add 3 hours
                $('#EndDate').val(endDate.toISOString().slice(0, 16));
            });
        });
    </script>
}
