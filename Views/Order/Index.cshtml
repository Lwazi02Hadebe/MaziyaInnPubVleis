@model IEnumerable<MaziyaInnPubVleis.Models.Order>
@{
    ViewData["Title"] = "Order History";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Order History</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="@Url.Action("Create")" class="btn btn-sm btn-outline-primary">
            <i class="fas fa-cash-register"></i> New Sale
        </a>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Order ID</th>
                <th>Date</th>
                <th>Customer</th>
                <th>Status</th>
                <th>Total Amount</th>
                <th>VAT</th>
                <th>Gross Profit</th>
                <th>Processed By</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in Model)
            {
                <tr>
                    <td>@order.OrderId</td>
                    <td>@order.OrderDate.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@(order.Customer?.Name ?? "Walk-in")</td>
                    <td>
                        <span class="badge @GetStatusBadgeClass(order.Status)">
                            @order.Status
                        </span>
                    </td>
                    <td>R @order.TotalAmount.ToString("N2")</td>
                    <td>R @order.VATAmount.ToString("N2")</td>
                    <td>R @order.GrossProfit.ToString("N2")</td>
                    <td>@order.ProcessedBy?.Username</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="@Url.Action("Details", new { id = order.OrderId })"
                               class="btn btn-outline-info" title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            @if (order.Status == MaziyaInnPubVleis.Models.OrderStatus.Pending)
                            {
                                <form method="post" action="@Url.Action("UpdateStatus", new { orderId = order.OrderId, status = MaziyaInnPubVleis.Models.OrderStatus.Completed })"
                                      style="display: inline;">
                                    <button type="submit" class="btn btn-outline-success" title="Complete Order">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </form>
                                <form method="post" action="@Url.Action("UpdateStatus", new { orderId = order.OrderId, status = MaziyaInnPubVleis.Models.OrderStatus.Cancelled })"
                                      style="display: inline;">
                                    <button type="submit" class="btn btn-outline-danger" title="Cancel Order">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </form>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@functions {
    private string GetStatusBadgeClass(MaziyaInnPubVleis.Models.OrderStatus status)
    {
        return status switch
        {
            MaziyaInnPubVleis.Models.OrderStatus.Completed => "bg-success",
            MaziyaInnPubVleis.Models.OrderStatus.Cancelled => "bg-danger",
            MaziyaInnPubVleis.Models.OrderStatus.Pending => "bg-warning",
            _ => "bg-secondary"
        };
    }
}
