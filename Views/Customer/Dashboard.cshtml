@{
    ViewData["Title"] = "Customer Dashboard";
    Layout = "_CustomerLayout";
}

<!-- Welcome Hero Section -->
<section class="customer-hero">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold text-white mb-3">Welcome back, @Context.Session.GetString("CustomerName")! 👋</h1>
                <p class="lead text-white mb-4">Here's what's happening with your account today</p>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-warning text-dark">
                        <i class="fas fa-star me-1"></i>Valued Customer
                    </span>
                    <span class="badge bg-light text-dark">
                        Member since @ViewBag.Customer?.RegistrationDate.ToString("MMM yyyy")
                    </span>
                </div>
            </div>
            <div class="col-lg-4 text-lg-end">
                <div class="card bg-dark bg-opacity-50 text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-user-circle fa-3x mb-2 text-warning"></i>
                        <h5>@Context.Session.GetString("CustomerName")</h5>
                        <p class="small mb-0">@Context.Session.GetString("CustomerEmail")</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Dashboard Content -->
<div class="container py-5">
    <!-- Quick Stats Cards -->
    <div class="row mb-5">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card stat-card text-white bg-primary border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="card-title mb-1">@ViewBag.RecentOrders.Count</h2>
                            <p class="card-text mb-0">Recent Orders</p>
                        </div>
                        <div class="icon-circle bg-primary bg-opacity-25">
                            <i class="fas fa-receipt fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="@Url.Action("Orders", "Customer")" class="text-white text-decoration-none small">
                            View all orders <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card stat-card text-white bg-success border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="card-title mb-1">@ViewBag.UpcomingEvents.Count</h2>
                            <p class="card-text mb-0">Upcoming Events</p>
                        </div>
                        <div class="icon-circle bg-success bg-opacity-25">
                            <i class="fas fa-calendar-alt fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="@Url.Action("Events", "Customer")" class="text-white text-decoration-none small">
                            Browse events <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card stat-card text-white bg-warning border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="card-title mb-1" id="cartCount">0</h2>
                            <p class="card-text mb-0">Cart Items</p>
                        </div>
                        <div class="icon-circle bg-warning bg-opacity-25">
                            <i class="fas fa-shopping-cart fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="@Url.Action("Cart", "Customer")" class="text-dark text-decoration-none small">
                            View cart <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card stat-card text-white bg-info border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="card-title mb-1" id="pointsBalance">250</h2>
                            <p class="card-text mb-0">Reward Points</p>
                        </div>
                        <div class="icon-circle bg-info bg-opacity-25">
                            <i class="fas fa-gem fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="#" class="text-white text-decoration-none small">
                            Earn more <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Quick Actions & Profile -->
        <div class="col-lg-4 mb-4">
            <!-- Quick Actions Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bolt me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <a href="@Url.Action("Index", "Customer")" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                            <div class="icon-circle-sm bg-primary text-white me-3">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Order Food & Drinks</h6>
                                <p class="text-muted mb-0 small">Browse our delicious menu</p>
                            </div>
                            <i class="fas fa-chevron-right text-muted"></i>
                        </a>

                        <a href="@Url.Action("Events", "Customer")" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                            <div class="icon-circle-sm bg-success text-white me-3">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Book Events</h6>
                                <p class="text-muted mb-0 small">Reserve your spot</p>
                            </div>
                            <i class="fas fa-chevron-right text-muted"></i>
                        </a>

                        <a href="@Url.Action("Cart", "Customer")" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                            <div class="icon-circle-sm bg-warning text-dark me-3">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">View Cart</h6>
                                <p class="text-muted mb-0 small" id="cartItemsText">0 items</p>
                            </div>
                            <i class="fas fa-chevron-right text-muted"></i>
                        </a>

                        <a href="@Url.Action("Profile", "Customer")" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                            <div class="icon-circle-sm bg-info text-white me-3">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">My Profile</h6>
                                <p class="text-muted mb-0 small">Update your information</p>
                            </div>
                            <i class="fas fa-chevron-right text-muted"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Account Summary Card -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-dark text-white py-3">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-line me-2"></i>Account Summary
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Member Since</span>
                            <strong>@ViewBag.Customer?.RegistrationDate.ToString("MMM dd, yyyy")</strong>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Total Orders</span>
                            <strong>@ViewBag.RecentOrders.Count</strong>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Email Verified</span>
                            <span class="badge bg-success">Yes</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">Account Status</span>
                            <span class="badge bg-success">Active</span>
                        </div>
                    </div>
                    <div class="progress mb-3" style="height: 8px;">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 65%;"
                             aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p class="small text-muted mb-0">65% to Gold Member status</p>
                </div>
            </div>
        </div>

        <!-- Recent Activity & Events -->
        <div class="col-lg-8">
            <!-- Recent Orders Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-success text-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-history me-2"></i>Recent Orders
                        </h5>
                        <span class="badge bg-light text-dark">Last 30 days</span>
                    </div>
                </div>
                <div class="card-body">
                    @if (ViewBag.RecentOrders.Count > 0)
                    {
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Order #</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in ViewBag.RecentOrders)
                                    {
                                        <tr>
                                            <td>
                                                <strong>#@order.OrderId</strong>
                                            </td>
                                            <td>@order.OrderDate.ToString("MMM dd")</td>
                                            <td>
                                                <span class="badge bg-secondary">@order.OrderItems.Count items</span>
                                            </td>
                                            <td>
                                                <strong class="text-success">R @order.TotalAmount.ToString("N2")</strong>
                                            </td>
                                            <td>
                                                <span class="badge bg-@(order.Status == MaziyaInnPubVleis.Models.OrderStatus.Completed ? "success" : order.Status == MaziyaInnPubVleis.Models.OrderStatus.Pending ? "warning" : "danger")">
                                                    @order.Status
                                                </span>
                                            </td>
                                            <td>
                                                <a href="@Url.Action("OrderDetails", "Customer", new { id = order.OrderId })"
                                                   class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye me-1"></i>View
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <a href="@Url.Action("Orders", "Customer")" class="btn btn-success">
                                <i class="fas fa-list me-1"></i>View All Orders
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No Orders Yet</h5>
                            <p class="text-muted mb-3">Start your Maziya Inn journey with your first order!</p>
                            <a href="@Url.Action("Index", "Customer")" class="btn btn-primary">
                                <i class="fas fa-utensils me-1"></i>Browse Menu
                            </a>
                        </div>
                    }
                </div>
            </div>

            <!-- Upcoming Events Card -->
            @if (ViewBag.UpcomingEvents.Count > 0)
            {
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-info text-white py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-calendar me-2"></i>Upcoming Events
                            </h5>
                            <span class="badge bg-light text-dark">Don't miss out!</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            @foreach (var eventItem in ViewBag.UpcomingEvents)
                            {
                                <div class="col-md-6">
                                    <div class="card border h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="card-title mb-0">@eventItem.EventName</h6>
                                                <span class="badge bg-primary">R @eventItem.TicketPrice.ToString("N2")</span>
                                            </div>
                                            <p class="card-text small text-muted mb-3">@eventItem.Description.Truncate(80)</p>
                                            <div class="event-meta">
                                                <div class="d-flex align-items-center mb-2">
                                                    <i class="fas fa-calendar text-primary me-2 fa-sm"></i>
                                                    <small class="text-muted">@eventItem.EventDate.ToString("MMM dd, yyyy")</small>
                                                </div>
                                                <div class="d-flex align-items-center mb-2">
                                                    <i class="fas fa-clock text-primary me-2 fa-sm"></i>
                                                    <small class="text-muted">@eventItem.EventDate.ToString("hh:mm tt")</small>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-users text-primary me-2 fa-sm"></i>
                                                    <small class="text-muted">
                                                        @(eventItem.MaxAttendees - eventItem.CurrentAttendees) spots left
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer bg-transparent border-top-0 pt-0">
                                            <div class="d-grid">
                                                <a href="@Url.Action("EventDetails", "Customer", new { id = eventItem.EventId })"
                                                   class="btn btn-outline-primary btn-sm">
                                                    <i class="fas fa-ticket-alt me-1"></i>Book Now
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="text-center mt-3">
                            <a href="@Url.Action("Events", "Customer")" class="btn btn-info">
                                <i class="fas fa-calendar-alt me-1"></i>View All Events
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Special Offers Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-gradient-primary text-white">
                <div class="card-body py-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="mb-2">🎉 Special Offer Just For You!</h4>
                            <p class="mb-0">Get 15% off your next order when you refer a friend to Maziya Inn.</p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <button class="btn btn-light btn-lg">
                                <i class="fas fa-gift me-2"></i>Claim Offer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .icon-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-circle-sm {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
    }

    .stat-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

    .list-group-item {
        border: none;
        transition: background-color 0.2s ease;
    }

        .list-group-item:hover {
            background-color: #f8f9fa;
        }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .progress {
        border-radius: 10px;
    }

    .progress-bar {
        border-radius: 10px;
    }
</style>

@section Scripts {
    <script>
        // Update cart count on page load
        $(document).ready(function() {
            updateCartCount();
        });

        function updateCartCount() {
            $.get('@Url.Action("GetCartCount", "Customer")', function(data) {
                $('#cartCount').text(data.count);
                $('#cartItemsText').text(data.count + ' item' + (data.count !== 1 ? 's' : ''));
            });
        }

        // Auto-update cart count every 30 seconds
        setInterval(updateCartCount, 30000);

        // Add some interactive animations
        $(document).ready(function() {
            // Animate stats cards on scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // Observe stat cards
            document.querySelectorAll('.stat-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        });

        // Quick action animations
        $('.list-group-item').hover(
            function() {
                $(this).find('.icon-circle-sm').css('transform', 'scale(1.1)');
            },
            function() {
                $(this).find('.icon-circle-sm').css('transform', 'scale(1)');
            }
        );
    </script>
}